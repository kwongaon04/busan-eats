<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>BUSAN EATS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <!-- Bootstrap CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      background: #f7f9fc;
      font-family: -apple-system, BlinkMacSystemFont, "Apple SD Gothic Neo", "Noto Sans KR", sans-serif;
    }
    header {
      background: linear-gradient(135deg, #1e90ff, #00c9a7);
      color: white;
      padding: 70px 20px;
      text-align: center;
    }
    header h1 {
      font-weight: 800;
      letter-spacing: 1px;
    }
    header p {
      opacity: 0.9;
    }
    .card {
      border: none;
      border-radius: 14px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.06);
    }
    .badge {
      font-weight: 500;
    }
    footer {
      text-align: center;
      padding: 30px;
      color: #777;
      font-size: 14px;
    }
  </style>
</head>

<body>

<header>
  <p class="mt-2">íŒŒì´ì¬ìœ¼ë¡œ ìˆ˜ì§‘Â·ê°€ê³µí•œ ë¶€ì‚° ì§€í•˜ì² ì—­ ì£¼ë³€ ë§›ì§‘ ë°ì´í„°</p>
</header>
  <a class="btn btn-light btn-lg mt-3" href="about.html">í”„ë¡œì íŠ¸ ì†Œê°œ ë³´ê¸°</a>
  <h1>BUSAN EATS</h1>

<main class="container my-5">

  <!-- ê²€ìƒ‰ ì˜ì—­ -->
  <div class="row g-2 mb-4">
    <div class="col-md-4">
      <input id="q" class="form-control form-control-lg" placeholder="ê²€ìƒ‰: ë§›ì§‘ëª… / ë©”ë‰´ / ì£¼ì†Œ">
    </div>
    <div class="col-md-3">
      <select id="station" class="form-select form-select-lg">
        <option value="">ì—­ ì „ì²´</option>
      </select>
    </div>
    <div class="col-md-3">
      <select id="category" class="form-select form-select-lg">
        <option value="">êµ¬ë¶„ ì „ì²´</option>
      </select>
    </div>
    <div class="col-md-2 d-grid">
      <button id="btn" class="btn btn-primary btn-lg">ê²€ìƒ‰</button>
    </div>
  </div>

  <p id="count" class="text-muted mb-3"></p>

  <!-- ì¹´ë“œ ì˜ì—­ -->
  <div id="cards" class="row g-3"></div>

</main>

<footer>
  BUSAN EATS Â· Python Data Project
</footer>

<script>
<script>
let ALL = [];

const $ = (id) => document.getElementById(id);

function norm(v){
  return (v ?? "").toString().trim();
}
function uniq(arr){
  return [...new Set(arr)].filter(Boolean).sort((a,b)=>a.localeCompare(b,'ko'));
}

function render(items){
  const countEl = $("count");
  if (countEl) countEl.innerText = `ê²€ìƒ‰ ê²°ê³¼ ${items.length}ê°œ (ìµœëŒ€ 60ê°œ í‘œì‹œ)`;

  const wrap = $("cards");
  if (!wrap) return;

  wrap.innerHTML = items.slice(0, 60).map(x => `
    <div class="col-md-4">
      <div class="card h-100">
        <div class="card-body">
          <h5 class="card-title">${x.name || "ì´ë¦„ ì—†ìŒ"}</h5>

          <div class="mb-2">
            ${x.category ? `<span class="badge bg-secondary">${x.category}</span>` : ""}
          </div>

          <div class="text-muted mb-2">
            ğŸ“ ${x.station || ""} ${x.exit ? `(${x.exit}ì¶œêµ¬)` : ""}
          </div>

          ${x.menu ? `<div>ğŸ½ï¸ <b>ëŒ€í‘œë©”ë‰´</b> ${x.menu}</div>` : ""}
          ${x.address ? `<div class="small text-muted mt-1">${x.address}</div>` : ""}
          ${x.phone ? `<div class="small mt-1">â˜ ${x.phone}</div>` : ""}
        </div>
      </div>
    </div>
  `).join("");
}

function apply(){
  const q = norm($("q")?.value).toLowerCase();
  const station = norm($("station")?.value);
  const category = norm($("category")?.value);

  let items = ALL;

  // ì—­/êµ¬ë¶„ í•„í„°
  if (station) items = items.filter(x => x.station === station);
  if (category) items = items.filter(x => x.category === category);

  // ê²€ìƒ‰ì–´(ë§›ì§‘ëª…/ë©”ë‰´/ì£¼ì†Œ)
  if (q){
    items = items.filter(x => {
      const name = (x.name || "").toLowerCase();
      const menu = (x.menu || "").toLowerCase();
      const addr = (x.address || "").toLowerCase();
      return name.includes(q) || menu.includes(q) || addr.includes(q);
    });
  }

  render(items);
}

function wire(){
  // ë²„íŠ¼ í´ë¦­ ê²€ìƒ‰
  $("btn")?.addEventListener("click", apply);

  // ì—”í„° ê²€ìƒ‰
  $("q")?.addEventListener("keydown", (e) => {
    if (e.key === "Enter") apply();
  });

  // ì…ë ¥í•  ë•Œë§ˆë‹¤ ìë™ ê²€ìƒ‰(ì›ì¹˜ ì•Šìœ¼ë©´ ì´ ì¤„ ì‚­ì œ)
  $("q")?.addEventListener("input", apply);

  // í•„í„° ë°”ê¾¸ë©´ ìë™ ê²€ìƒ‰
  $("station")?.addEventListener("change", apply);
  $("category")?.addEventListener("change", apply);
}

async function init(){
  // âœ… ê²½ë¡œëŠ” ì´ê±¸ë¡œ ê³ ì •(ì‹¤íŒ¨ ì œì¼ ì ìŒ)
  const res = await fetch("data/restaurants.json", { cache: "no-store" });
  const raw = await res.json();

  // âœ… ê³µë°±/íƒ­ ë•Œë¬¸ì— ê²€ìƒ‰ ì•ˆ ë˜ëŠ” ê±° ë°©ì§€: ì „ë¶€ trimí•´ì„œ í†µì¼
  ALL = raw.map(x => ({
    line: norm(x.line),
    station: norm(x.station),
    name: norm(x.name),
    category: norm(x.category),
    menu: norm(x.menu),
    address: norm(x.address),
    phone: norm(x.phone),
    exit: norm(x.exit),
  }));

  // ì˜µì…˜ ì±„ìš°ê¸°
  const stations = uniq(ALL.map(x => x.station));
  const categories = uniq(ALL.map(x => x.category));

  if ($("station")){
    $("station").innerHTML = `<option value="">ì—­ ì „ì²´</option>` +
      stations.map(s => `<option value="${s}">${s}</option>`).join("");
  }
  if ($("category")){
    $("category").innerHTML = `<option value="">êµ¬ë¶„ ì „ì²´</option>` +
      categories.map(c => `<option value="${c}">${c}</option>`).join("");
  }

  wire();
  render(ALL);
}

init().catch(err => {
  console.error(err);
  const countEl = $("count");
  if (countEl) countEl.innerText = "ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì„œë²„ ì‹¤í–‰/ê²½ë¡œë¥¼ í™•ì¸í•˜ì„¸ìš”.";
});
</script>

</script>

</body>
</html>
